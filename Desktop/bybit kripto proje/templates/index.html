<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîê Kripto Portf√∂y Risk Analiz Platformu</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #6366f1;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --success-color: #10b981;
        }
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        .card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            background: white;
        }
        .card-header {
            background: linear-gradient(135deg, var(--primary-color), #764ba2);
            color: white;
            border-radius: 15px 15px 0 0 !important;
            padding: 15px 20px;
            font-weight: 600;
        }
        .risk-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
        }
        .risk-low { background: #d1fae5; color: #065f46; }
        .risk-medium { background: #fef3c7; color: #92400e; }
        .risk-high { background: #fee2e2; color: #991b1b; }
        .risk-critical { background: #fecaca; color: #7f1d1d; }
        .warning-box {
            background: #fef3c7;
            border-left: 4px solid var(--warning-color);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .danger-box {
            background: #fee2e2;
            border-left: 4px solid var(--danger-color);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .info-box {
            background: #dbeafe;
            border-left: 4px solid var(--primary-color);
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .btn-primary {
            background: var(--primary-color);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
        }
        .btn-primary:hover {
            background: #4f46e5;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }
        .stat-label {
            color: #6b7280;
            font-size: 0.9rem;
            margin-top: 5px;
        }
        .progress-bar-custom {
            height: 25px;
            border-radius: 10px;
        }
        table {
            font-size: 0.9rem;
        }
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
    </style>
</head>
<body>
    <div class="main-container">
        <!-- Header -->
        <div class="card mb-4">
            <div class="card-header">
                <h1 class="mb-0"><i class="bi bi-shield-check"></i> Kripto Portf√∂y Risk Analiz Platformu</h1>
                <p class="mb-0 mt-2" style="opacity: 0.9; font-size: 0.9rem;">
                    Profesyonel risk y√∂netimi ve pozisyon boyutlandƒ±rma ara√ßlarƒ±
                </p>
            </div>
        </div>

        <!-- Anlƒ±k Fiyat Grafikleri -->
        <div class="row mb-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-graph-up"></i> BTC Anlƒ±k Fiyat</span>
                        <span class="badge bg-primary" id="btc-price-badge">Y√ºkleniyor...</span>
                    </div>
                    <div class="card-body">
                        <canvas id="btcChart" height="150"></canvas>
                        <div class="mt-2">
                            <small class="text-muted" id="btc-last-update">Son g√ºncelleme: -</small>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-graph-up"></i> ETH Anlƒ±k Fiyat</span>
                        <span class="badge bg-success" id="eth-price-badge">Y√ºkleniyor...</span>
                    </div>
                    <div class="card-body">
                        <canvas id="ethChart" height="150"></canvas>
                        <div class="mt-2">
                            <small class="text-muted" id="eth-last-update">Son g√ºncelleme: -</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <ul class="nav nav-tabs mb-4" id="mainTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="portfolio-tab" data-bs-toggle="tab" data-bs-target="#portfolio" type="button">
                    <i class="bi bi-wallet2"></i> Portf√∂y Analizi
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="leverage-tab" data-bs-toggle="tab" data-bs-target="#leverage" type="button">
                    <i class="bi bi-exclamation-triangle"></i> Kaldƒ±ra√ß Analizi
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="position-tab" data-bs-toggle="tab" data-bs-target="#position" type="button">
                    <i class="bi bi-calculator"></i> Pozisyon Boyutu
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="risk-reward-tab" data-bs-toggle="tab" data-bs-target="#risk-reward" type="button">
                    <i class="bi bi-graph-up"></i> Risk/Reward
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="integration-tab" data-bs-toggle="tab" data-bs-target="#integration" type="button">
                    <i class="bi bi-link-45deg"></i> Bybit Entegrasyonu
                </button>
            </li>
        </ul>

        <div class="tab-content" id="mainTabsContent">
            <!-- Portf√∂y Analizi Tab -->
            <div class="tab-pane fade show active" id="portfolio" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">Portf√∂y Giri≈üi</div>
                            <div class="card-body">
                                <div id="portfolio-inputs">
                                    <div class="portfolio-item mb-3">
                                        <label>Coin</label>
                                        <input type="text" class="form-control coin-symbol" placeholder="BTC" value="BTC" 
                                               list="coin-list-portfolio" autocomplete="off">
                                        <datalist id="coin-list-portfolio">
                                            <option value="BTC">Bitcoin</option>
                                            <option value="ETH">Ethereum</option>
                                            <option value="BNB">Binance Coin</option>
                                            <option value="SOL">Solana</option>
                                            <option value="XRP">Ripple</option>
                                            <option value="ADA">Cardano</option>
                                            <option value="DOGE">Dogecoin</option>
                                            <option value="TRX">Tron</option>
                                            <option value="AVAX">Avalanche</option>
                                            <option value="LINK">Chainlink</option>
                                            <option value="DOT">Polkadot</option>
                                            <option value="MATIC">Polygon</option>
                                            <option value="SHIB">Shiba Inu</option>
                                            <option value="LTC">Litecoin</option>
                                            <option value="BCH">Bitcoin Cash</option>
                                            <option value="UNI">Uniswap</option>
                                            <option value="ATOM">Cosmos</option>
                                        </datalist>
                                        <label class="mt-2">Miktar</label>
                                        <input type="number" class="form-control coin-amount" placeholder="0.5" step="0.000001" value="0.5">
                                        <label class="mt-2">Girdi Fiyatƒ± (Opsiyonel)</label>
                                        <input type="number" class="form-control coin-price" placeholder="Auto" step="0.01">
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" onclick="addPortfolioItem()">
                                    <i class="bi bi-plus"></i> Coin Ekle
                                </button>
                                <button class="btn btn-primary w-100 mt-3" onclick="analyzePortfolio()">
                                    <i class="bi bi-graph-up-arrow"></i> Portf√∂y√º Analiz Et
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div id="portfolio-results"></div>
                    </div>
                </div>
            </div>

            <!-- Kaldƒ±ra√ß Analizi Tab -->
            <div class="tab-pane fade" id="leverage" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">Kaldƒ±ra√ßlƒ± Pozisyonlar</div>
                            <div class="card-body">
                                <label>Toplam Hesap Bakiyesi (USD)</label>
                                <input type="number" class="form-control mb-3" id="total-balance" placeholder="10000" value="10000">
                                
                                <div id="leverage-inputs">
                                    <div class="leverage-item mb-3 border p-3 rounded">
                                        <label>Coin</label>
                                        <input type="text" class="form-control leverage-symbol" placeholder="BTC" value="BTC"
                                               list="coin-list-leverage" autocomplete="off">
                                        <datalist id="coin-list-leverage">
                                            <option value="BTC">Bitcoin</option>
                                            <option value="ETH">Ethereum</option>
                                            <option value="BNB">Binance Coin</option>
                                            <option value="SOL">Solana</option>
                                            <option value="XRP">Ripple</option>
                                            <option value="ADA">Cardano</option>
                                            <option value="DOGE">Dogecoin</option>
                                            <option value="TRX">Tron</option>
                                            <option value="AVAX">Avalanche</option>
                                            <option value="LINK">Chainlink</option>
                                            <option value="DOT">Polkadot</option>
                                            <option value="MATIC">Polygon</option>
                                            <option value="SHIB">Shiba Inu</option>
                                            <option value="LTC">Litecoin</option>
                                            <option value="BCH">Bitcoin Cash</option>
                                            <option value="UNI">Uniswap</option>
                                            <option value="ATOM">Cosmos</option>
                                        </datalist>
                                        <label class="mt-2">Pozisyon Boyutu (USD)</label>
                                        <input type="number" class="form-control leverage-size" placeholder="10000" step="0.01" value="10000">
                                        <label class="mt-2">Kaldƒ±ra√ß (x)</label>
                                        <input type="number" class="form-control leverage-ratio" placeholder="10" value="10" min="1">
                                        <label class="mt-2">Girdi Fiyatƒ±</label>
                                        <input type="number" class="form-control leverage-entry" placeholder="45000" step="0.01" value="45000">
                                        <label class="mt-2">Y√∂n</label>
                                        <select class="form-control leverage-side">
                                            <option value="Buy">Long (Alƒ±≈ü)</option>
                                            <option value="Sell">Short (Satƒ±≈ü)</option>
                                        </select>
                                    </div>
                                </div>
                                <button class="btn btn-sm btn-outline-primary" onclick="addLeverageItem()">
                                    <i class="bi bi-plus"></i> Pozisyon Ekle
                                </button>
                                <button class="btn btn-primary w-100 mt-3" onclick="analyzeLeverage()">
                                    <i class="bi bi-exclamation-triangle"></i> Kaldƒ±ra√ß Analizi
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div id="leverage-results"></div>
                    </div>
                </div>
            </div>

            <!-- Pozisyon Boyutu Tab -->
            <div class="tab-pane fade" id="position" role="tabpanel">
                <div class="row">
                    <div class="col-md-4">
                        <div class="card">
                            <div class="card-header">Pozisyon Boyutu Hesaplayƒ±cƒ±</div>
                            <div class="card-body">
                                <label>Coin</label>
                                <input type="text" class="form-control mb-3" id="position-symbol" placeholder="BTC" value="BTC"
                                       list="coin-list-position" autocomplete="off">
                                <datalist id="coin-list-position">
                                    <option value="BTC">Bitcoin</option>
                                    <option value="ETH">Ethereum</option>
                                    <option value="BNB">Binance Coin</option>
                                    <option value="SOL">Solana</option>
                                    <option value="XRP">Ripple</option>
                                    <option value="ADA">Cardano</option>
                                    <option value="DOGE">Dogecoin</option>
                                    <option value="TRX">Tron</option>
                                    <option value="AVAX">Avalanche</option>
                                    <option value="LINK">Chainlink</option>
                                    <option value="DOT">Polkadot</option>
                                    <option value="MATIC">Polygon</option>
                                    <option value="SHIB">Shiba Inu</option>
                                    <option value="LTC">Litecoin</option>
                                    <option value="BCH">Bitcoin Cash</option>
                                    <option value="UNI">Uniswap</option>
                                    <option value="ATOM">Cosmos</option>
                                </datalist>
                                
                                <label>Hesap Bakiyesi (USD)</label>
                                <input type="number" class="form-control mb-3" id="position-balance" placeholder="10000" value="10000">
                                
                                <label>Risk Toleransƒ±</label>
                                <select class="form-control mb-3" id="risk-tolerance">
                                    <option value="conservative">Konservatif (%0.5 risk)</option>
                                    <option value="moderate" selected>Dengeli (%1 risk)</option>
                                    <option value="aggressive">Agresif (%2 risk)</option>
                                </select>
                                
                                <label>Kaldƒ±ra√ß (x)</label>
                                <input type="number" class="form-control mb-3" id="position-leverage" placeholder="1" value="1" min="1" max="10">
                                
                                <label>Stop-Loss (%)</label>
                                <input type="number" class="form-control mb-3" id="stop-loss-pct" placeholder="Auto" step="0.1">
                                
                                <button class="btn btn-primary w-100" onclick="calculatePositionSize()">
                                    <i class="bi bi-calculator"></i> Hesapla
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-8">
                        <div id="position-results"></div>
                    </div>
                </div>
            </div>

            <!-- Risk/Reward Tab -->
            <div class="tab-pane fade" id="risk-reward" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">Risk/Reward Hesaplayƒ±cƒ±</div>
                            <div class="card-body">
                                <label>Girdi Fiyatƒ±</label>
                                <input type="number" class="form-control mb-3" id="rr-entry" placeholder="45000" step="0.01" value="45000">
                                
                                <label>Stop-Loss Fiyatƒ±</label>
                                <input type="number" class="form-control mb-3" id="rr-stop" placeholder="42750" step="0.01" value="42750">
                                
                                <label>Take-Profit Fiyatƒ±</label>
                                <input type="number" class="form-control mb-3" id="rr-tp" placeholder="50000" step="0.01" value="50000">
                                
                                <label>Y√∂n</label>
                                <select class="form-control mb-3" id="rr-side">
                                    <option value="Buy">Long (Alƒ±≈ü)</option>
                                    <option value="Sell">Short (Satƒ±≈ü)</option>
                                </select>
                                
                                <button class="btn btn-primary w-100" onclick="calculateRiskReward()">
                                    <i class="bi bi-graph-up"></i> Hesapla
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div id="risk-reward-results"></div>
                    </div>
                </div>
            </div>

            <!-- Bybit Entegrasyonu Tab -->
            <div class="tab-pane fade" id="integration" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">üîó Bybit API Entegrasyonu</div>
                            <div class="card-body">
                                <div class="info-box mb-3">
                                    <strong>üìñ Nasƒ±l √áalƒ±≈üƒ±r?</strong>
                                    <p class="mb-0">Bybit API key'lerinizi girerek pozisyonlarƒ±nƒ±zƒ± otomatik √ßekin. 
                                    API key'leriniz sadece tarayƒ±cƒ±nƒ±zda saklanƒ±r, hi√ßbir yere kaydedilmez.</p>
                                </div>

                                <div class="danger-box mb-3">
                                    <strong>üîë √ñNEMLƒ∞: Hangi API Key Tipi?</strong>
                                    <p class="mb-2"><strong>‚úÖ System-generated API Keys (HMAC) se√ßin!</strong></p>
                                    <ul class="mb-0" style="font-size: 0.9rem;">
                                        <li>‚ùå Self-generated API Keys (RSA) se√ßmeyin</li>
                                        <li>‚úÖ Bybit'te API key olu≈ütururken "System-generated" se√ßeneƒüini se√ßin</li>
                                        <li>‚úÖ API v5 kullanƒ±n (v3 deƒüil)</li>
                                        <li>‚úÖ Sadece "Read" izni verin</li>
                                    </ul>
                                </div>

                                <div id="integration-status" class="mb-3"></div>

                                <div id="connection-form">
                                    <label>Bybit API Key</label>
                                    <input type="text" class="form-control mb-3" id="api-key" 
                                           placeholder="API Key'inizi girin">
                                    
                                    <label>Bybit API Secret</label>
                                    <input type="password" class="form-control mb-3" id="api-secret" 
                                           placeholder="API Secret'ƒ±nƒ±zƒ± girin">
                                    
                                    <div class="warning-box mb-3">
                                        <strong>‚ö†Ô∏è G√ºvenlik:</strong>
                                        <ul class="mb-0" style="font-size: 0.9rem;">
                                            <li>API key'leriniz sadece bu oturumda kullanƒ±lƒ±r</li>
                                            <li>Sayfa kapanƒ±nca silinir</li>
                                            <li>Sadece "Read" izni verin (yazma izni YOK)</li>
                                            <li>IP kƒ±sƒ±tlamasƒ± ekleyin</li>
                                        </ul>
                                    </div>

                                    <button class="btn btn-primary w-100 mb-2" onclick="connectBybit()">
                                        <i class="bi bi-link-45deg"></i> Baƒülan
                                    </button>
                                </div>

                                <div id="connected-actions" style="display: none;">
                                    <button class="btn btn-success w-100 mb-2" onclick="syncBybitPositions()">
                                        <i class="bi bi-arrow-clockwise"></i> Pozisyonlarƒ± √áek
                                    </button>
                                    <button class="btn btn-warning w-100 mb-2" onclick="loadPortfolioFromBybit()">
                                        <i class="bi bi-download"></i> Portf√∂y√º Y√ºkle
                                    </button>
                                    <button class="btn btn-danger w-100" onclick="disconnectBybit()">
                                        <i class="bi bi-x-circle"></i> Baƒülantƒ±yƒ± Kes
                                    </button>
                                </div>

                                <div class="mt-3">
                                    <a href="https://www.bybit.com/app/user/api-management" target="_blank" 
                                       class="btn btn-sm btn-outline-info w-100">
                                        <i class="bi bi-box-arrow-up-right"></i> Bybit'te API Key Olu≈ütur
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div id="integration-results"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/coins.js"></script>
    <script src="/static/app.js"></script>
    <script src="/static/charts.js"></script>
</body>
</html>

